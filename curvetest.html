<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Curve Test</title>

  
  <script src="./gl-matrix-min.js"></script>
  
  <script src="./Bezier.js"></script>
  <script src="./Interpolation.js"></script>
  <script src="./Frame.js"></script>
  <script src="./Track.js"></script>
</head>
<body>
<canvas id="mycanvas" width="640" height="480"></canvas>

<script>
var canvas = document.getElementById("mycanvas");
var ctx = canvas.getContext("2d");

function DrawPoint(x, y, color, pointSize) {
  ctx.fillStyle = color;
  ctx.fillRect(x, y, pointSize, pointSize);
}
function DrawLine(x1, y1, x2, y2, color) {
  ctx.strokeStyle = color;
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.stroke();
}

/**
  @brief linear interpolate floats a and b based on t
  @return interpolated float
*/
function LerpFloat(a, b, t) {
  return a + (b-a)*t;
}

/**
  @brief hermite spline interpolation of input time t and length 3 arrays
  @return interpolated length 3 point on curve
*/
function Hermite(t, p1, s1, p2, s2) {
  const tt = t*t;
  const ttt = tt*t;
  const h1 = 2.0*ttt - 3.0*tt + 1.0;
  const h2 = -2.0*ttt + 3.0*tt;
  const h3 = ttt - 2.0 * tt + t;
  const h4 = ttt - tt;
  var p1h1 = vec3.create(); vec3.scale(p1h1, p1, h1);
  var p2h2 = vec3.create(); vec3.scale(p2h2, p2, h2);
  var s1h3 = vec3.create(); vec3.scale(s1h3, s1, h3);
  var s2h4 = vec3.create(); vec3.scale(s2h4, s2, h4);
  vec3.add(p1h1, p1h1, p2h2);
  vec3.add(p1h1, p1h1, s1h3);
  vec3.add(p1h1, p1h1, s2h4);
  return p1h1;
}

var p1 = [10.0, 400.0, 0.0];
var c1 = [50.0, 100.0, 0.0]; // C1
var p2 = [410.0, 400.0, 0.0]; // P2
var c2 = [350.0, 100.0, 0.0]; // C2
var bez = new Bezier(
  p1, c1, p2, c2
);

// Draw control points
DrawPoint(p1[0], p1[1], "#FF0000", 5);
DrawPoint(c1[0], c1[1], "#00FF00", 5);
DrawPoint(p2[0], p2[1], "#0000FF", 5);
DrawPoint(c2[0], c2[1], "#FF00FF", 5);

// Draw handles
DrawLine(p1[0], p1[1], c1[0], c1[1], "#FFFF00");
DrawLine(p2[0], p2[1], c2[0], c2[1], "#0000FF");

// Draw curve
for (var i=0; i<199; ++i) {
  var t0 = i / 199.0;
  var t1 = (i+1) / 199.0;
  //var thisPoint = bez.Interpolate(t0);
  //var nextPoint = bez.Interpolate(t1);
  var thisPoint = Hermite(t0, p1, c1, p2, c2);
  var nextPoint = Hermite(t1, p1, c1, p2, c2);
  DrawLine(thisPoint[0], thisPoint[1], nextPoint[0], nextPoint[1], "#000000");
}

</script>

</body>
</html>

