<!DOCTYPE html>
<html lang="en-US">
<head>
    <title>WebGL Class Test</title>

    <script src="glMatrix-0.9.5.min.js"></script>

    <style>
        #canvasContainer {
            width: 640px;
            height: 480px;
            overflow: hidden;
            margin-left: auto;
            margin-right: auto;
        }
        #myCanvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <div id="canvasContainer">
        <canvas id="myCanvas"></canvas>
    </div>

    <script>

        class Display {
            
            // constructor
            constructor(canvasIdStr) {
                // get the canvas
                this._canvas = document.getElementById(canvasIdStr);
                if(!this._canvas){
                    alert('Display constructor: failed to load canvas!');
                }

                // get the WebGL context
                this._gl = this._canvas.getContext("experimental-webgl");
                if(!this._gl){
                    alert('Display constructor: failed to initialize WebGL!');
                }
                this._gl.viewportWidth  = this.canvas.width;
                this._gl.viewportHeight = this.canvas.height;

                // enable the z buffer
                this._gl.enable(this._gl.DEPTH_TEST);
            }

            // clears the buffer bits and sets the viewport width
            clear() {
                this._gl.viewport(0, 0, this._gl.viewportWidth, this._gl.viewportHeight);
                this._gl.clear(this._gl.COLOR_BUFFER_BIT | this._gl.DEPTH_BUFFER_BIT);
            }

            // getter functions
            get canvas() {
                return this._canvas;
            }
            get glContext() {
                return this._gl;
            }
        }

        class Camera {
            constructor(pos) {
                // vec3 representing the camera's position
                this._pos = pos;

                // initialize the projection matrix
                this._projMat = mat4.create();
            }

            // set the camera's projection matrix
            perspective(gl) {
                mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, this._projMat);
            }
        }

        // the global move matrix
        var mvMatrix = mat4.create();

        class Object {
            constructor(pos) {
                // vec3 representing the object's position
                this._pos = pos;

                // position buffer
                this._VBO = 0;
            }

            // draw the object
            draw(gl, shaderID) {
                // move to where we're drawing
                mat4.translate(mvMatrix, this._pos);

                // bind draw the object
                gl.bindBuffer(gl.ARRAY_BUFFER, this._VBO);
                gl.vertexAttribPointer(
                    shaderID.vertexPositionAttribute,
                    this._VBO.itemSize,
                    gl.FLOAT,
                    false,
                    0, 0
                );

                // TODO - implement me!
                //setMatrixUniforms();
                gl.drawArrays(gl.TRIANGLES, 0, this._VBO.numItems);
            }
            
        }

        var display = new Display("myCanvas");
        var camera = new Camera([0.0, 0.0, 0.0]); // pos at 0.0
        
        // set the bg color and clear the canvas
        display.glContext.clearColor(0.0, 0.3, 0.3, 1.0);
        display.clear();

        // set the opengl projection matrix
        camera.perspective(display.glContext);


    </script>

</body>
</html>